{% extends 'properties2/base.html' %}

{% load i18n %}
{% load static %}

{% block title %}
{% trans 'Home' %}
{% endblock %}

{% block styles %}
<!--    INDEX STYLE-->
<link rel="stylesheet" href="{% static 'css/myhome/index.css' %}"/>
{% endblock %}
{% block body %}
<div hidden>
    <!--    hidden input for form-->
    <form id="searchForm" method="post">{% csrf_token %}
        {{form.business_type}}
        {{form.property_type}}
        {{form.property_condition}}
        {{form.city}}
        {{form.state}}
        {{form.locality}}
    </form>
</div>

<div class="input-group col-lg-10 offset-lg-1  col-xl-8 offset-xl-2  col-md-12  col-sm-12 my-5">
    <div class="col-xm-12 col-sm-4 col-lg-2 col-xl-2 mx-0 px-0">
        <button id="butBusiness" class="btn btn-outline-secondary btn-block dropdown-toggle down-in-group1" type="button"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{% trans 'Sale' %}
        </button>
        <div class="dropdown-menu col-sm-12 text-center">
            {% for choice in form.business_type.field.choices%}
            <a class="dropdown-item" onclick="selectBusinessType('{{choice.0}}')">{{choice.1}}</a>
            {% endfor %}
        </div>
    </div>
    <div class="col-xm-12 col-sm-4 col-lg-2 col-xl-2 mx-0 px-0">
        <button id="butProperty" class="btn btn-outline-secondary  btn-block dropdown-toggle down-in-group2" type="button"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{% trans 'Apartment' %}
        </button>
        <div class="dropdown-menu col-sm-12 text-center">
            {% for choice in form.property_type.field.choices%}
            <a class="dropdown-item" onclick="selectPropertyType('{{choice.0}}')">{{choice.1}}</a>
            {% endfor %}
        </div>
    </div>
    <div class="col-xs-12 col-sm-4 col-lg-2 col-xl-2 mx-0 px-0">
        <button id="butCondition" class="btn btn-outline-secondary  btn-block dropdown-toggle down-in-group3"  type="button"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{% trans 'New' %}
        </button>
        <div class="dropdown-menu col-sm-12 text-center">
            {% for choice in form.property_condition.field.choices%}
            <a class="dropdown-item" onclick="selectCondition('{{choice.0}}')">{{choice.1}}</a>
            {% endfor %}
        </div>
    </div>
    <input type="text" class="form-control input-in-group" id="autocomplete"  placeholder=""
           aria-label="input with three button addons" aria-describedby="button-addon3">
    <div class="input-group-append">
        <button id="submitButton" type="button" class="btn btn-primary button-in-group"><i class="fas fa-search"></i></button>
    </div>
    <!--    <input type="text" id="newField" value="hello">-->
</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC4Gol1U3BbHLkWzeJb5kbggvFAPVKZRAA&libraries=places&region=CO"></script>
<script>
    $("#submitButton").click( function() {
        $("#searchForm").submit();
    });
    function initAutocomplete() {
      // Create the autocomplete object, restricting the search predictions to
      // geographical location types.
      let addressIn = document.getElementById('autocomplete');
      autocomplete = new google.maps.places.Autocomplete(
      addressIn, {types: ['(cities)'], componentRestrictions: {country: 'co'}});
      console.log(autocomplete)
      // Avoid paying for data that you don't need by restricting the set of
      // place fields that are returned to just the address components.
        autocomplete.setFields(['address_components']);
      // When the user selects an address from the drop-down, populate the
      // address fields in the form.

       autocomplete.addListener('place_changed', fillInAddress);
         }

    function fillInAddress() {
      // Get the place details from the autocomplete object.
      var place = autocomplete.getPlace();
        console.log(place)
      for (var i = 0; i < place.address_components.length; i++) {

        var addressType = place.address_components[i].types[0];
        if (addressType === "locality"){
            document.getElementById('id_locality').value = place.address_components[i].long_name ;
         }
        if (addressType === "administrative_area_level_2"){
            document.getElementById('id_city').value = place.address_components[i].long_name;
         }
        if (addressType === "administrative_area_level_1"){
            document.getElementById('id_state').value = place.address_components[i].long_name;
            break;
         }
      }
    }
    function selectBusinessType(choice){
        $('#id_business_type option[value="' + choice +'"]').prop("selected", true);
        document.getElementById('butBusiness').innerHTML = $('#id_business_type option:selected').html();
    };
    function selectPropertyType(choice){
        $('#id_property_type option[value="' + choice +'"]').prop("selected", true);
        document.getElementById('butProperty').innerHTML = $('#id_property_type option:selected').html();
    };
    function selectCondition(choice){
        $('#id_property_condition option[value="' + choice +'"]').prop("selected", true);
        document.getElementById('butCondition').innerHTML = $('#id_property_condition option:selected').html();
    };
    initAutocomplete()
</script>
{% endblock %}